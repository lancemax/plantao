

<div class="well hero">
	<h1>Plantões</h1>
       
</div>
<div class="container">
    <div class="row-fluid">

	    <div class="span10">
	 		<h2>Aqui você vai encontrar todos os plantões que estão disponiveis, plantões que foram cedidos por outros médicos, assim facilitando a manutenção do serviço nos hospitais e ajudando a evitar as faltas nos plantões e emergencias nos hospitais no Brasil.</h2>

	    </div> 
	    <div class="span2">
			<%= link_to 'Cadastrar Plantão', new_job_path ,:class => "btn huge btn-success" %>
		</div> 
	</div>
	<br clear="all" />
	<br clear="all" />


	<%= simple_form_for @search ,  :url => :showJobs , :validate => true ,:html => {:class => 'well form-horizontal',:novalidate => true } do |f| %>
 
   Filtrar por:
            <div class="control-group">
				<%= f.association :hospital , :prompt => "Escolha um Hospital", :label => 'Hospital' %>
			</div>
			<div class="control-group">
					<%= f.association :area , :prompt => "Escolha uma Área", :label => 'Área' %>
			</div>
			<div class="control-group">
    			<%= f.association :shift,:prompt => "Escolha um Turno", :label => 'Turno/Horário',:collection => Shift.all(:order => 'shifts.id') %>
  			</div>

			 <%= f.button :submit, "Filtrar", :class => "btn btn-primary form-inline" %>
            
	<% end %>


	<ul class="thumbnails">
		<% @jobs.each do |job| %>
	    	<a href="<%=  job_path(job) %>">
	    		<li class="span3 white">
			        <table class="table table-condensed	caixa thumbnail" >
			        	<thead>
			        	<tr>
			        		<th colspan="2">
			        			<h4><%= job.area.name %> <br>(<%= job.hospital.city.name %> - <%= job.hospital.state.acronym %>) </h4>
			        		</th>
			        	</tr>
			        	 <tr>
			            	<th>Local:</th>
			            	<td><%=truncate(job.hospital.name, :ommision => "...", :length => 31) %></td>
			            </tr>
			            <tr>
			            	<th>Data:</th>
			            	<td><%= job.date.strftime("%d/%m/%Y - %H:%Mh")	 %></td>
			            </tr>
						<tr>
							<th>Valor:</th>
							<td><%= to_real(job.price) %></td> 
						</tr>
						<tr>
							<th>Cedente:</th>
							<td><%= truncate(job.user.name,:ommision => "...", :length => 30) %></td> 
						</tr>
			            <tr>
			            

			            	<td colspan="2" id="job<%=job.id%>">
		            			<% if user_signed_in? %>
		            				<%= simple_form_for [:customer,@request],:html => {:class => 'form-inline'}, :remote => true  do |f| %>
		            					<div class="btn btn-info"><b><%=job.requests.count%></b> Candidato(s)</div>
				            			<% if !Request.where(:user_id => current_user.id,:job_id =>job.id).first %>
					            			<% if current_user.id != job.user_id  %>
				            				
				            					<%= f.hidden_field :job_id ,:value => job.id %>
				            					<%= f.submit "Pegar Plantão", :class => "btn btn-success" %>
				            				<% else %>	
				            					<div class="btn">Meu Plantão</div>
				            				<% end %>
				            			<% else  %>		
				            				<div class="btn btn-warning">Pleiteado</div>
				            			<% end %>	
				            		<% end %>
		            			<% end %>

			            	</td>
			             </tr>
			             </thead>
			        </table>
		    	</li>
			</a>
		<% end %>
	</ul>
</div> 