<h1>Meus Plantões Pleiteados</h1>

<ul class="thumbnails">
    <% @requests.each do |request| %>
        <a href="<%=  job_path(request.job) %>"><li class="span3 white">
            <table class="table table-condensed caixa thumbnail" >
              <thead>
              <tr>
                <th colspan="2">
                  <h4><%= request.job.area.name %> <br>(<%= request.job.hospital.city.name %> - <%= request.job.hospital.state.acronym %>) </h4>
                </th>
              </tr>
               <tr>
                  <th>Local:</th>
                  <td><%=truncate(request.job.hospital.name, :ommision => "...", :length => 31) %></td>
                </tr>
                <tr>
                  <th>Data:</th>
                  <td><%= request.job.date.strftime("%d/%m/%Y - %H:%Mh")   %></td>
                </tr>
          <tr>
            <th>Valor:</th>
            <td><%= to_real(request.job.price) %></td> 
          </tr>
          <tr>
            <th>Cedente:</th>
            <td><%= truncate(request.job.user.name,:ommision => "...", :length => 30) %></td> 
          </tr>
                <tr>
                

                  <td colspan="2" id="job<%=request.job.id%>">
                    <div class="btn btn-info"><b><%=request.status_request.name%></b></div>
                    <% if request.job.request_id.nil? %>
                        <% if request.status_request_id == 1 %>
                            <%= link_to customer_request_path(request), confirm: 'Você tem Certeza que deseja Cancelar?', method: :delete, :remote => true do %>
                               <div class="btn btn-danger"><b>Cancelar</b></div>
                            <% end %>
                        <% else %>
                            <%= link_to customer_request_path(request), confirm: 'Você tem Certeza que deseja Repleitear?', method: :put, :remote => true do %>
                               <div class="btn btn-warning"><b>Repleitear</b></div>
                            <% end %>
                        <% end %>
                    <% elsif  request.job.request_id == request.id and request.status_request_id == 2 %>  
                        <%= link_to customer_request_path(request), confirm: 'A desistência depende da aceitação do moderador desse plantão, Caso o moderador não conceda a Desistência até o dia do plantão, você deverá assumi-lo. Você tem certeza que deseja continuar?', method: :delete, :remote => true do %>
                            <div class="btn btn-danger"><b>Solicitar Desistencia</b></div>
                        <% end %>
                    <% end %> 
                  </td>
                 </tr>
                 </thead>

            </table>
        </li>
    </a>
              
      <% end %>
    </ul>





<!--
<table class="table table-striped table-bordered table-condensed">
  <tr>
    <th>Plantão</th>
    <th>Especialidade</th>
    <th>Data</th>
    <th>Status</th>
    <th></th>  
    <th></th>
  </tr>

<% @requests.each do |request| %>
  <tr>
    <td><%= request.job.hospital.name %></td>
    <td><%= request.job.area.name %></td>
    <td><%= request.job.date.strftime("%d/%m/%Y - %H:%Mh") %></td>
    <td>
      <% if request.job.request_id.nil? %>
          Aguardando Moderação
      <% elsif request.job.request_id != request.id %>
          Cedido para outro candidato
      <% else %>
          Aceito
      <% end %>

    </td>
    
    <td><%= link_to 'Ver', customer_request_path(request) %></td>
    <% if request.job.request_id.nil? %>
      <td><%= link_to 'Desistir', customer_request_path(request), confirm: 'Você tem Certeza?', method: :delete, :remote => true %>
      </td>
     <% elsif  request.job.request_id == request.id %>  
       <td><%= link_to 'Solicitar Desistência', customer_request_path(request), confirm: 'A desistência depende da aceitação do moderador desse plantão.Você tem certeza que deseja continuar?', method: :delete, :remote => true %>
        </td>
    <% end %> 
  </tr>
<% end %>
</table>

-->